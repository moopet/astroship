---
import Container from "@components/container.astro";
// import Cta from "@components/cta.astro";
// import Features from "@components/features.astro";
// import Hero from "@components/hero.astro";
// import Logos from "@components/logos.astro";
import Layout from "@layouts/Layout.astro";

import Image from "@components/Image.astro";
import Text from "@components/Text.astro";

const response = await fetch("https://graphql.datocms.com/", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Accept: "application/json",
    Authorization: `Bearer ${import.meta.env.DATOCMS_API_KEY}`,
  },
  body: JSON.stringify({
    query: `query Page {
      page {
        id
        title
        slug
        content {
          ... on ImageRecord {
            image {
        	    url
              alt
            }
          }
          ... on TestimonialRecord {
            quote
            attribution
          }
          ... on TextRecord {
        	  heading
          }
        }
      }
    }
  `,
  }),
});

const json = await response.json();
const data = json.data.page;
console.log(data);
---

<Layout title={data.title}>
  <Container>
    {
      data.content.map((item: any) => {
        switch (item._modelApiKey) {
          case "image":
            return <Image item={item} />;
          case "text":
            return <Text item={item} />;
          default:
            return null;
        }
      })
    }
  </Container>
</Layout>
